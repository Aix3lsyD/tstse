% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/kalman_miss.R
\name{kalman_miss}
\alias{kalman_miss}
\title{Kalman Filter and Smoother with Missing Observations}
\usage{
kalman_miss(y, x0, P0, Phi, Q, A, R)
}
\arguments{
\item{y}{Numeric vector. The observed time series data. Missing values
are handled via the time-varying observation matrix \code{A}.}

\item{x0}{Numeric scalar or vector. Initial state estimate (prior mean of
the state at time 0).}

\item{P0}{Numeric scalar or matrix. Initial state covariance (prior
variance/covariance of the state at time 0).}

\item{Phi}{Numeric scalar or matrix. State transition matrix. Describes how
the state evolves: \eqn{x_t = \Phi x_{t-1} + v_t}.}

\item{Q}{Numeric scalar or matrix. State noise variance (process noise
covariance). The variance of \eqn{v_t}.}

\item{A}{Array of dimension \verb{(p, q, n)} where \code{p} is the observation
dimension, \code{q} is the state dimension, and \code{n} is the number of time
points. This is the time-varying observation matrix. To indicate a missing
observation at time \code{t}, set \code{A[, , t]} to zeros.}

\item{R}{Numeric scalar or matrix. Observation noise variance (measurement
noise covariance). The variance of \eqn{w_t}.}
}
\value{
A list with class \code{"kalman"} containing:
\item{y}{The original observations.}
\item{predicted}{List with \code{state} (predicted state estimates) and
\code{var} (predicted state covariances).}
\item{filtered}{List with \code{state} (filtered state estimates) and
\code{var} (filtered state covariances).}
\item{smoothed}{List with \code{state} (smoothed state estimates) and
\code{var} (smoothed state covariances).}
\item{result}{The raw output from \code{\link[astsa:Ksmooth]{astsa::Ksmooth()}} for advanced use.}
}
\description{
Performs Kalman filtering and smoothing for a linear Gaussian state-space
model that can handle missing observations via a time-varying observation
matrix. This is a convenience wrapper around \code{\link[astsa:Ksmooth]{astsa::Ksmooth()}}.
}
\details{
This function extends \code{\link[=kalman]{kalman()}} to handle missing observations and
multivariate state-space models. The model is:

\strong{State equation:}
\deqn{x_t = \Phi x_{t-1} + v_t, \quad v_t \sim N(0, Q)}

\strong{Observation equation:}
\deqn{y_t = A_t x_t + w_t, \quad w_t \sim N(0, R)}

Note that the observation matrix \eqn{A_t} is time-varying. Missing
observations are handled by setting the corresponding row of \eqn{A_t}
to zero, which effectively removes that observation from the likelihood.
}
\note{
This function requires the \code{astsa} package. Install it with
\code{install.packages("astsa")} if needed.

For simple univariate models without missing data, use \code{\link[=kalman]{kalman()}} instead.
}
\examples{
\dontrun{
# Local level model with missing observations
set.seed(123)
n <- 100

# True state is a random walk
x_true <- cumsum(rnorm(n, sd = 1))
# Observations with some missing (NA)
y <- x_true + rnorm(n, sd = 2)
missing_idx <- c(20, 21, 22, 50, 51)
y[missing_idx] <- NA

# Create time-varying A matrix (1x1xn array)
# A[,,t] = 1 for observed, 0 for missing
A <- array(1, dim = c(1, 1, n))
A[, , missing_idx] <- 0

# Replace NA with arbitrary value (will be ignored due to A=0)
y_filled <- y
y_filled[is.na(y_filled)] <- 0

# Fit Kalman filter
result <- kalman_miss(
  y = y_filled,
  x0 = 0,
  P0 = 10,
  Phi = 1,
  Q = 1,
  A = A,
  R = 4
)

# Plot results
plot(y, type = "p", pch = 16, cex = 0.5, col = "gray")
lines(x_true, col = "black", lwd = 2)
lines(as.numeric(result$smoothed$state), col = "red", lwd = 2)
}

}
\references{
Shumway, R. H., & Stoffer, D. S. (2017). \emph{Time Series Analysis and Its
Applications: With R Examples} (4th ed.). Springer.
}
\seealso{
\code{\link[=kalman]{kalman()}} for simpler models without missing data,
\code{\link[astsa:Ksmooth]{astsa::Ksmooth()}} for the underlying implementation.
}
