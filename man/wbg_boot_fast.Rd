% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/wbg_boot_fast.R
\name{wbg_boot_fast}
\alias{wbg_boot_fast}
\title{Fast WBG Bootstrap Test for Trend (C++ Implementation)}
\usage{
wbg_boot_fast(
  x,
  nb = 399L,
  maxp = 5L,
  criterion = c("aic", "aicc", "bic"),
  bootadj = FALSE,
  min_p = 1L,
  seed = NULL
)
}
\arguments{
\item{x}{A numeric vector containing the time series data.}

\item{nb}{Number of bootstrap replicates. Default is 399.}

\item{maxp}{Maximum AR order for model selection. Default is 5.}

\item{criterion}{Character. Information criterion for order selection:
\code{"aic"}, \code{"aicc"}, or \code{"bic"}. Default is \code{"aic"}.}

\item{bootadj}{Logical. If \code{TRUE}, performs the COBA (Cochrane-Orcutt
Bootstrap Adjustment) variance adjustment for improved small-sample
performance. Default is \code{FALSE} for maximum speed.}

\item{min_p}{Integer. Minimum AR order for the CO residual model.
Default \code{1L} matches the paper's Cochrane-Orcutt procedure (always
AR(1)+). Set to \code{0L} to allow AR(0) selection when residuals appear
uncorrelated.}

\item{seed}{Integer, random seed for reproducibility. Default NULL.}
}
\value{
A list of class "wbg_boot_fast" containing:
\item{p}{AR order selected for the series under null hypothesis.}
\item{phi}{AR coefficients for the null model.}
\item{vara}{Innovation variance for the null model.}
\item{pvalue}{Bootstrap p-value for trend test (two-sided, abs-based).}
\item{pvalue_upper}{Upper-tail p-value: P(T* >= T_obs). Use for testing
positive trend or for quantile-based two-sided test.}
\item{pvalue_lower}{Lower-tail p-value: P(T* <= T_obs). Use for testing
negative trend.}
\item{pvalue_quantile}{Quantile-based two-sided p-value:
\code{2 * min(pvalue_upper, pvalue_lower)}. This matches the rejection
rule in Section 2.1 of the original WBG paper (Woodward et al. 1997).
May differ from the abs-based \code{pvalue} when the bootstrap
distribution is asymmetric.}
\item{tco_obs}{Observed t-statistic from Cochrane-Orcutt fit.}
\item{boot_tstats}{Vector of bootstrap t-statistics.}
\item{boot_seeds}{Vector of RNG seeds used for each bootstrap replicate.
Useful for auditability and exact reproduction of individual replicates.}
\item{n}{Length of input series.}
\item{nb}{Number of bootstrap replicates used.}
\item{maxp}{Maximum AR order considered.}
\item{criterion}{Information criterion used.}

If \code{bootadj = TRUE}, also includes:
\item{tco_obs_adj}{COBA-adjusted observed t-statistic.}
\item{pvalue_adj}{COBA-adjusted two-sided p-value.}
\item{adj_factor}{Variance adjustment factor (C from paper).}
\item{median_phi}{AR coefficients from the median bootstrap model.}
}
\description{
High-performance bootstrap hypothesis test for trend in time series.
Uses the Woodward-Bottone-Gray (WBG) method with C++ parallelization
via TBB (Intel Threading Building Blocks).
}
\details{
This is a high-performance C++ implementation of \code{\link[=wbg_boot]{wbg_boot()}},
optimized for large-scale applications. Key differences:

\itemize{
\item Uses Burg algorithm only (most stable for bootstrap)
\item Parallelization via TBB (works on all platforms)
\item All bootstrap iterations run in C++ (no R overhead)
\item Thread-safe RNG (dqrng with xoshiro256+)
}

Expected speedup is 10-25x compared to \code{\link[=wbg_boot]{wbg_boot()}} depending on
series length and number of available CPU cores.

The bootstrap procedure:
\enumerate{
\item Fit Cochrane-Orcutt model to observed data using C++
\item Fit AR(p) model under null hypothesis (no trend)
\item Generate \code{nb} bootstrap series from AR(p) in parallel
\item Compute CO t-statistic for each bootstrap series
\item p-value = proportion of |bootstrap t| >= |observed t|
}

\strong{COBA Adjustment:}
When \code{bootadj = TRUE}, a second-stage bootstrap adjusts the observed
statistic for variance inflation caused by AR coefficient estimation
bias. This provides better small-sample significance levels but
approximately doubles computation time. The adjustment uses the median
AR coefficients from the first stage, where the "median" is selected
based on phi(1) = 1 - sum(phi) as described in the original paper.
\strong{Note:} COBA requires storing AR fits for all bootstrap replicates,
using approximately \code{nb * maxp * 8} bytes (e.g., 16 MB for nb=100,000,
maxp=20). For large-scale simulation studies, consider memory constraints.

\strong{P-value Methods:}
Three p-values are returned. The main \code{pvalue} uses the absolute value
method \verb{P(|T*| >= |T_obs|)}, which is standard for two-sided bootstrap
tests. Additionally, \code{pvalue_upper} and \code{pvalue_lower} provide one-sided
p-values for directional hypotheses or for computing the quantile-based
two-sided p-value: \code{2 * min(pvalue_upper, pvalue_lower)}. The quantile-based
method can differ from the abs-based method when the bootstrap distribution
is asymmetric.

\strong{Performance Tuning:}
For optimal parallel performance, you may want to disable BLAS multi-threading
to avoid nested parallelism (TBB threads + BLAS threads). Set these environment
variables \strong{before loading any packages} that use BLAS:

\if{html}{\out{<div class="sourceCode">}}\preformatted{Sys.setenv(
  VECLIB_MAXIMUM_THREADS = "1",
  OPENBLAS_NUM_THREADS = "1",
  MKL_NUM_THREADS = "1",
  OMP_NUM_THREADS = "1",
  BLAS_NUM_THREADS = "1"
)
}\if{html}{\out{</div>}}

On macOS with Apple Accelerate, \code{VECLIB_MAXIMUM_THREADS} is the key variable.
Note: These must be set early in the R session (before BLAS initializes) to
take effect. A session restart may be required after changing them.

\strong{Reproducibility:}
Results are exactly reproducible given the same \code{seed}, platform, compiler,
and math library. Minor differences in bootstrap t-statistics may occur
across different platforms (e.g., Windows vs Linux vs macOS) due to
implementation-defined behavior in C++ uniform distribution generation.
This does not affect statistical validity - p-values and conclusions will
be equivalent within sampling variability.
}
\examples{
\donttest{
# Test series with no trend (should be non-significant)
set.seed(123)
x <- arima.sim(list(ar = 0.7), n = 100)
result <- wbg_boot_fast(x, nb = 199, seed = 456)
print(result)

# Test series with trend (should be significant)
set.seed(123)
x_trend <- arima.sim(list(ar = 0.7), n = 100) + 0.1 * (1:100)
result <- wbg_boot_fast(x_trend, nb = 199, seed = 456)
print(result)

# With COBA adjustment for better small-sample performance
result_adj <- wbg_boot_fast(x_trend, nb = 199, bootadj = TRUE, seed = 456)
print(result_adj)
}

\dontrun{
# Benchmark comparison
library(microbenchmark)
x <- arima.sim(list(ar = c(0.7, -0.2)), n = 500)
microbenchmark(
  fast = wbg_boot_fast(x, nb = 199, seed = 42),
  fast_coba = wbg_boot_fast(x, nb = 199, bootadj = TRUE, seed = 42),
  original = wbg_boot(x, nb = 199, seed = 42),
  times = 5
)
}

}
\references{
Woodward, W. A., Bottone, S., and Gray, H. L. (1997). "Improved Tests for
Trend in Time Series Data." \emph{Journal of Agricultural, Biological, and
Environmental Statistics}, 2(4), 403-416.
}
\seealso{
\code{\link[=wbg_boot]{wbg_boot()}} for the original R implementation,
\code{\link[=wbg_boot_flex]{wbg_boot_flex()}} for flexible statistics with COBA,
\code{\link[=co]{co()}} for Cochrane-Orcutt estimation.
}
