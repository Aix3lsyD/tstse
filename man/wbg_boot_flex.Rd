% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/wbg_boot_flex.R
\name{wbg_boot_flex}
\alias{wbg_boot_flex}
\alias{print.wbg_boot_flex}
\alias{summary.wbg_boot_flex}
\title{Flexible WBG Bootstrap Test for Trend}
\usage{
wbg_boot_flex(
  x,
  stat_fn,
  nb = 399L,
  p_max = 5L,
  ar_method = c("burg", "mle"),
  criterion = c("aic", "aicc", "bic"),
  bootadj = TRUE,
  cores = 1L,
  seed = NULL,
  verbose = TRUE
)

\method{print}{wbg_boot_flex}(x, ...)

\method{summary}{wbg_boot_flex}(object, ...)
}
\arguments{
\item{x}{A wbg_boot_flex object}

\item{stat_fn}{Function. A function that takes a numeric vector and returns
a single numeric test statistic. Use factory functions like
\code{\link[=make_stat_co]{make_stat_co()}}, \code{\link[=make_stat_ols_t]{make_stat_ols_t()}}, etc., or create your own with
signature \verb{function(x) -> numeric(1)}.}

\item{nb}{Integer. Number of bootstrap replicates. Default is 399.}

\item{p_max}{Integer. Maximum AR order to consider when fitting the null
model. Order is selected by information criterion. Default is 5.}

\item{ar_method}{Character. Method for AR estimation of null model:
\code{"burg"} (default, always stationary) or \code{"mle"} (less biased near
unit root but requires stationarity checking).}

\item{criterion}{Character. Information criterion for AR order selection:
\code{"aic"} (default), \code{"aicc"}, or \code{"bic"}.}

\item{bootadj}{Logical. If TRUE (default), performs the COBA
(Cochrane-Orcutt Bootstrap Adjustment) variance adjustment for
improved small-sample performance.}

\item{cores}{Integer or NULL. Number of CPU cores for parallel processing.
Default NULL uses \code{getOption("tstse.cores", 1)}. Set to 0 to use all
available cores.}

\item{seed}{Integer or NULL. Random seed for reproducibility. If NULL
(default), no seed is set.}

\item{verbose}{Logical. If TRUE (default), display progress messages.}

\item{...}{Additional arguments (ignored)}

\item{object}{A wbg_boot_flex object}
}
\value{
An object of class \code{"wbg_boot_flex"} containing:
\item{obs_stat}{Observed test statistic.}
\item{boot_dist}{Vector of bootstrap statistics.}
\item{pvalue}{Two-sided p-value.}
\item{pvalue_upper}{Upper-tail p-value.}
\item{pvalue_lower}{Lower-tail p-value.}
\item{ar_order}{Selected AR order under null.}
\item{ar_phi}{AR coefficients under null.}
\item{ar_method}{AR estimation method used.}
\item{n}{Sample size.}
\item{nb}{Number of bootstrap replicates.}

If \code{bootadj = TRUE}, also includes:
\item{obs_stat_adj}{COBA-adjusted observed statistic.}
\item{pvalue_adj}{COBA-adjusted two-sided p-value.}
\item{adj_factor}{Variance adjustment factor.}
\item{median_phi}{Median AR coefficients from first stage.}
}
\description{
Performs a bootstrap hypothesis test for trend in a time series while
accounting for autocorrelation. Unlike \code{\link[=wbg_boot]{wbg_boot()}}, this function accepts
any test statistic function, enabling flexible testing with different
statistics (Cochrane-Orcutt, OLS, Mann-Kendall, Sen's slope, etc.).
}
\details{
This function implements the Woodward-Bottone-Gray (WBG) bootstrap test
for trend in autocorrelated time series. The null hypothesis is that the
series is a stationary AR(p) process with no trend.

\strong{Procedure:}
\enumerate{
\item Compute the observed test statistic \code{stat_fn(x)}
\item Fit AR(p) model to data under null hypothesis (no trend)
\item Generate \code{nb} bootstrap series from the fitted AR model using
\code{\link[=gen_ar_fast]{gen_ar_fast()}}
\item Compute test statistic for each bootstrap series
\item Calculate p-value as proportion of |bootstrap stat| >= |observed stat|
}

\strong{COBA Adjustment:}
When \code{bootadj = TRUE}, a second-stage bootstrap adjusts the observed
statistic for variance inflation, providing better small-sample
performance. The adjustment uses the median AR coefficients from
the first stage.

\strong{Statistic Functions:}
Use the provided factory functions to create statistics:
\itemize{
\item \code{\link[=make_stat_co]{make_stat_co()}} - Cochrane-Orcutt t-statistic
\item \code{\link[=make_stat_ols_t]{make_stat_ols_t()}} - OLS t-statistic
\item \code{\link[=make_stat_ols_slope]{make_stat_ols_slope()}} - OLS slope estimate
\item \code{\link[=make_stat_mk]{make_stat_mk()}} - Mann-Kendall S (requires Kendall package)
\item \code{\link[=make_stat_spearman]{make_stat_spearman()}} - Spearman correlation
\item \code{\link[=make_stat_sen]{make_stat_sen()}} - Sen's slope
\item \code{\link[=make_stat_hac]{make_stat_hac()}} - HAC t-statistic (requires sandwich, lmtest)
\item \code{\link[=make_stat_bn]{make_stat_bn()}} - Bloomfield-Nychka t-statistic
\item \code{\link[=make_stat_lr]{make_stat_lr()}} - Likelihood ratio
\item \code{\link[=make_stat_gls]{make_stat_gls()}} - GLS t-statistic (requires nlme)
}

\strong{Performance:}
Uses \code{\link[=gen_ar_fast]{gen_ar_fast()}} which provides ~30-50x speedup over general
ARMA generators for bootstrap resampling.
}
\section{Methods (by generic)}{
\itemize{
\item \code{print(wbg_boot_flex)}: Print method for wbg_boot_flex objects

\item \code{summary(wbg_boot_flex)}: Summary method for wbg_boot_flex objects

}}
\examples{
\donttest{
# Test for trend in white noise (should not reject)
set.seed(123)
x <- rnorm(100)
stat_fn <- make_stat_co()
result <- wbg_boot_flex(x, stat_fn, nb = 99, seed = 456, verbose = FALSE)
print(result)

# Test for trend in series with actual trend (should reject)
set.seed(123)
x_trend <- 0.1 * (1:100) + arima.sim(list(ar = 0.7), n = 100)
result <- wbg_boot_flex(x_trend, stat_fn, nb = 99, seed = 456, verbose = FALSE)
result$pvalue  # Should be small

# Use different statistics
stat_ols <- make_stat_ols_t()
result_ols <- wbg_boot_flex(x_trend, stat_ols, nb = 99, seed = 456, verbose = FALSE)

stat_spear <- make_stat_spearman()
result_spear <- wbg_boot_flex(x_trend, stat_spear, nb = 99, seed = 456, verbose = FALSE)
}

}
\references{
Woodward, W. A., Bottone, S., and Gray, H. L. (1997). "Improved Tests for
Trend in Time Series Data." \emph{Journal of Agricultural, Biological, and
Environmental Statistics}, 2(4), 403-416.
}
\seealso{
\code{\link[=wbg_boot]{wbg_boot()}} for the simpler interface with Cochrane-Orcutt only,
\code{\link[=make_stat_co]{make_stat_co()}} and other statistic factory functions,
\code{\link[=gen_ar_fast]{gen_ar_fast()}} for the fast AR generator used internally.
}
